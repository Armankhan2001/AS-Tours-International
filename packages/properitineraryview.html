<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AS Tours International — Package Itinerary</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght=500;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>

    <style>
        /* --- Root Variables & Base Styles --- */
        :root {
            --navy: #07203a;
            --gold: #d4af37;
            --secondary-blue: #0077b6;
            --accent-red: #e63946;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background: #f0f2f5;
            /* Mobile: Padding for h-16 (4rem) header */
            /* padding-top: 4rem;  */
        }

        .font-playfair { font-family: 'Playfair Display', serif; }

        /* --- Custom Component Styles --- */

        /* Premium CTA button */
        .btn-gold {
            background: linear-gradient(90deg, var(--gold), #f3d27a);
            color: var(--navy);
            font-weight: 600;
            font-size: 0.875rem; 
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        /* Logo badge style */
        .logo-badge {
            height: 140px;
            width: 140px;
            background-color: #ffd700;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            /* border-radius: 9999px; Make it fully round */
        }

        .logo-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        }

        .logo-badge img {
            width: 90%;
            height: auto;
            padding: 4px;
        }

        @media (min-width: 1024px) {
            .logo-badge {
                height: 160px;
                width: 160px;
            }
            body {
                 /* Desktop: Padding for h-24 (6rem) header */
                padding-top: 0rem;
            }
        }

        /* Responsive Table Refactor (Mobile-first list view) */
        @media (max-width: 768px) {
            /* Hide the table header on small screens */
            .responsive-table thead {
                display: none;
            }
            /* Make table rows act like blocks for vertical stacking */
            .responsive-table tbody, .responsive-table tr {
                display: block;
            }
            /* Add margin/padding to separate rows */
            .responsive-table tr {
                margin-bottom: 0.75rem; /* Space between "rows" (now blocks) */
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            }
            /* Make table cells act like blocks */
            .responsive-table td {
                display: block;
                text-align: right !important; /* Align content to the right */
                border: none !important;
                border-bottom: 1px dotted #e5e7eb !important;
                padding: 0.5rem 1rem !important;
                position: relative;
            }
            /* Use 'data-label' attribute to display the column header */
            .responsive-table td::before {
                content: attr(data-label);
                float: left;
                font-weight: 600;
                color: var(--navy);
            }
            /* Last cell in the block row */
            .responsive-table tr td:last-child {
                border-bottom: none !important;
            }
        }

        /* Print-specific styles to hide navbar and buttons */
        @media print {
            .navbar-print-hide, .btn-group {
                display: none !important;
            }
            body {
                padding-top: 0 !important;
                background: #fff !important;
            }
            .container {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
        }
    </style>
</head>
<body class="antialiased">
<header class="relative top-1 z-50 bg-white/95 backdrop-blur-md shadow-sm">
    
    <div class="max-w-7xl mx-auto px-4 lg:px-8">
        <div class="flex items-center justify-between h-16">

            <!-- Logo Badge -->
            <div class="absolute top-0 left-4 z-50">
            <a href="../index.html" class="logo-badge">
                <img src="../image/astourlogo.png" alt="AS Tours International">
            </a>
            </div>

            <!-- Spacer for logo -->
            <div class="w-36 flex-shrink-0"></div>

            <!-- Desktop Nav -->
            <nav class="hidden lg:flex items-center gap-8 text-sm font-medium">
            <a href="packages.html" class="text-[#d4af37] font-bold">Packages</a>
            <a href="../templates/Travel/b2b/Visa/clientvisaquotations.html" class="hover:text-[#d4af37]">Visa Services</a>
            <a href="../templates/Travel/b2b/Visa/b2b.html" class="ml-2 inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm border border-transparent btn-gold">Partner with Us</a>
            </nav>

            <div class="lg:hidden">
            <button id="mobileBtn" class="p-2 rounded-md ring-1 ring-slate-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            </div>
        </div>
    </div>

    <div id="mobileMenu" class="hidden lg:hidden bg-white border-t border-gray-200 w-full absolute top-16 left-0 shadow-lg">
        <div class="px-6 py-4 space-y-3 text-[var(--navy)] font-medium">
            <br>
            <br>
            <br>
            <a href="packages.html" class="text-[#d4af37] font-bold">Package</a>
            <a href="../templates/Travel/b2b/Visa/clientvisaquotations.html" class="block hover:text-[var(--gold)]">Visa Services</a>
            <a href="../templates/Travel/b2b/Visa/b2b.html" class="block mt-4 px-4 py-2 rounded-full btn-gold text-center">Partner with Us</a>
        </div>
    </div>
    </header>
    <div id="loadingScreen" class="fixed inset-0 bg-white/90 backdrop-blur-sm z-[60] flex flex-col items-center justify-center">
        <div class="spinner border-4 border-gray-200 border-l-[var(--gold)] rounded-full w-10 h-10 animate-spin"></div>
        <p class="mt-4 text-xl font-semibold text-[var(--navy)]">Loading Package Itinerary...</p>
        <p class="mt-1 text-sm text-gray-500">Please wait while we fetch the latest travel data.</p>
    </div>

    <br>
    <br>

    <main class="container w-full max-w-4xl mx-auto mt-5 mb-10 bg-white p-4 sm:p-8 md:p-10 rounded-xl shadow-2xl hidden" id="preview">
        
        <div class="text-center mb-6" id="logoBox"></div>
        
        <div class="text-center text-[var(--navy)] font-playfair text-2xl sm:text-3xl md:text-4xl font-extrabold mb-8 break-words" id="packageTitle">PACKAGE TITLE</div>

        <h2 class="section bg-[var(--gold)] text-[var(--navy)] p-2 px-4 text-lg font-bold inline-block rounded-lg shadow-md mb-4 mt-8">DAYWISE ITINERARY</h2>
        <div id="itinerary">
            </div>

        <h2 class="section bg-[var(--gold)] text-[var(--navy)] p-2 px-4 text-lg font-bold inline-block rounded-lg shadow-md mb-4 mt-8">HOTEL OPTIONS :</h2>
        <div class="overflow-x-auto">
            <table class="responsive-table w-full border-collapse mt-4 rounded-xl overflow-hidden text-sm md:text-base">
                <thead>
                    <tr class="bg-[var(--navy)] text-white font-semibold">
                        <th class="p-3 border border-gray-300">CITY NAME</th>
                        <th class="p-3 border border-gray-300">HOTEL NAME</th>
                        <th class="p-3 border border-gray-300">NO. OF NIGHT</th>
                        <th class="p-3 border border-gray-300">MEAL PLAN</th>
                    </tr>
                </thead>
                <tbody id="hotelTable" class="text-gray-700 bg-white"></tbody>
            </table>
        </div>
        
        <div class="bg-red-100 text-[var(--accent-red)] font-extrabold text-center p-3 mt-4 rounded-lg text-lg shadow-inner" id="totalCost"></div>

        <h2 class="section bg-[var(--gold)] text-[var(--navy)] p-2 px-4 text-lg font-bold inline-block rounded-lg shadow-md mb-4 mt-8">INCLUSIONS</h2>
        <div class="bg-gray-50 p-4 rounded-xl shadow-inner text-gray-700 leading-relaxed" id="inclusions">
            </div>

        <h2 class="section bg-[var(--gold)] text-[var(--navy)] p-2 px-4 text-lg font-bold inline-block rounded-lg shadow-md mb-4 mt-8">EXCLUSIONS</h2>
        <div class="bg-gray-50 p-4 rounded-xl shadow-inner text-gray-700 leading-relaxed" id="exclusions">
            </div>

        <h2 class="section bg-[var(--gold)] text-[var(--navy)] p-2 px-4 text-lg font-bold inline-block rounded-lg shadow-md mb-4 mt-8" id="noteHeader" style="display:none;">NOTE</h2>
        <div class="bg-gray-50 p-4 rounded-xl shadow-inner text-gray-700 leading-relaxed" id="noteContent" style="display:none;">
            </div>
    </main>

    <div class="btn-group text-center mt-8 pb-8 navbar-print-hide hidden" id="btnGroup">
        <button class="bg-[var(--secondary-blue)] text-white px-5 py-3 rounded-xl font-semibold shadow-lg hover:bg-[#023e8a] transition duration-300 inline-flex items-center gap-2 m-2" id="downloadBtn">
            <i class="fa-solid fa-file-pdf"></i> Download PDF
        </button>
        <button class="bg-[var(--secondary-blue)] text-white px-5 py-3 rounded-xl font-semibold shadow-lg hover:bg-[#023e8a] transition duration-300 inline-flex items-center gap-2 m-2" id="shareBtn">
            <i class="fa-solid fa-share-nodes"></i> Share Link
        </button>
    </div>

    <script>
        // --- DOM Elements ---
        const mobileBtn = document.getElementById('mobileBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const loadingScreen = document.getElementById('loadingScreen');
        const previewDiv = document.getElementById('preview');
        const btnGroupDiv = document.getElementById('btnGroup');
        const logoBox = document.getElementById("logoBox");
        const packageTitle = document.getElementById("packageTitle");
        const itineraryDiv = document.getElementById("itinerary");
        const hotelTable = document.getElementById("hotelTable");
        const totalCost = document.getElementById("totalCost");
        const inclusionsDiv = document.getElementById("inclusions");
        const exclusionsDiv = document.getElementById("exclusions");
        const noteHeader = document.getElementById("noteHeader");
        const noteContent = document.getElementById("noteContent");

        // --- Configuration ---
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKWpvBUstFi-xtd__NDN3MqnMBb04fzGfAb9Ce27ao0gMGejfXqCp9V_Dh4G_Z8ungzPf4MHsy0hkx/pub?output=csv";
        const params = new URLSearchParams(window.location.search);
        const packageName = params.get("package"); 

        // --- Mobile Menu Toggle ---
        mobileBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Data Loading Logic ---
        function hideLoaderAndShowContent() {
            loadingScreen.classList.add('hidden');
            previewDiv.classList.remove('hidden');
            btnGroupDiv.classList.remove('hidden');
        }

        function displayError(message) {
            loadingScreen.classList.add('hidden');
            previewDiv.classList.remove('hidden');
            previewDiv.innerHTML = `<p class='text-center py-10 text-red-600 font-semibold text-xl'>❌ ${message}</p>`;
            btnGroupDiv.classList.add('hidden');
        }

        // Use direct CSV download for speed
        Papa.parse(sheetUrl, { 
            download: true, 
            header: true, 
            skipEmptyLines: true, 
            complete: function(results) {
                const allData = results.data;
                const currentPkg = allData.find(r => r['Package Name'] === packageName);

                if (!currentPkg) { 
                    displayError("Package not found. Please check the URL or go back to the packages page.");
                    return; 
                }
                
                hideLoaderAndShowContent();

                // 1. Logo and Title
                if(currentPkg["Logo"]){ logoBox.innerHTML = `<img src="${currentPkg["Logo"]}" alt="Logo" class="w-36 mx-auto rounded-xl shadow-md">`; }
                packageTitle.innerText = currentPkg["Package Name"] + " – " + currentPkg["Duration"];

                // 2. Itinerary
                if(currentPkg["Itinerary"]){
                    const days = currentPkg["Itinerary"].split(/Day\s*\d+:/i);
                    let matches = currentPkg["Itinerary"].match(/Day\s*\d+:/gi) || [];
                    let formatted = "";
                    for(let i=1;i<days.length;i++){
                        let lines = days[i].trim().split("\n").map(l=>l.trim()).filter(l=>l.length > 0); 
                        if (lines.length > 0) {
                            // Apply modern Tailwind classes to the day block
                            formatted += `<div class="day p-4 mb-4 rounded-xl border-l-4 border-[var(--secondary-blue)] bg-blue-50 shadow-sm">
                                <strong><span class="text-lg text-[var(--accent-red)]">${matches[i-1].trim()}</span> ${lines[0]||""}</strong>
                                <ul class="list-disc pl-5 mt-2 text-gray-700 space-y-1">` 
                                + lines.slice(1).map(l=>`<li>${l}</li>`).join("")
                                + "</ul></div>";
                        }
                    }
                    itineraryDiv.innerHTML = formatted;
                }

                // 3. Hotels
                const headers = ["CITY NAME", "HOTEL NAME", "NO. OF NIGHT", "MEAL PLAN"];
                if(currentPkg["Hotels"]){
                    let hotelData = currentPkg["Hotels"].split("\n").map(h=>h.trim()).filter(h=>h.length > 0);
                    let rows = hotelData.map(h=>{
                        let parts = h.split("|").map(s=>s.trim());
                        let cells = parts.map((cell, index) => {
                            // Added data-label for responsive table view on mobile
                            return `<td class="p-2 md:p-3 border border-gray-200 text-center" data-label="${headers[index] || ''}">${cell||"-"}</td>`;
                        }).join("");
                        return `<tr class="border-b border-gray-200">${cells}</tr>`;
                    }).join("");
                    hotelTable.innerHTML = rows;
                }

                // 4. Price
                totalCost.innerText = currentPkg["Price"]||"Price not specified.";

                // 5. Inclusions (Improved list formatting with bullet points)
                inclusionsDiv.innerHTML = currentPkg["Inclusions"] 
                    ? `<ul class="list-disc pl-5 space-y-1">${currentPkg["Inclusions"].split("\n").map(i=>i.trim()).filter(i=>i.length > 0).map(i=>`<li>${i}</li>`).join("")}</ul>`
                    : "Not specified.";

                // 6. Exclusions (Improved list formatting with bullet points)
                exclusionsDiv.innerHTML = currentPkg["Exclusions"] 
                    ? `<ul class="list-disc pl-5 space-y-1">${currentPkg["Exclusions"].split("\n").map(i=>i.trim()).filter(i=>i.length > 0).map(i=>`<li>${i}</li>`).join("")}</ul>`
                    : "Not specified.";

                // 7. Note (Improved list formatting with bullet points)
                const noteText = currentPkg["Note"] ? currentPkg["Note"].trim() : "";
                const noteContentLines = noteText.split("\n").map(i=>i.trim()).filter(i=>i.length > 0);
                
                if (noteContentLines.length > 0) {
                     noteHeader.style.display = "block";
                     noteContent.style.display = "block";
                     noteContent.innerHTML = `<ul class="list-disc pl-5 space-y-1">${noteContentLines.map(i=>`<li>${i}</li>`).join("")}</ul>`;
                } else {
                    noteHeader.style.display = "none";
                    noteContent.style.display = "none";
                }
            },
            error: function(err, file, inputElem, reason) {
                displayError(`Error loading data: ${reason}. Please check your connection or try again later.`);
            }
        });

        // --- Button Handlers (Kept the original logic for copy/print) ---
        document.getElementById("downloadBtn").addEventListener("click", () => {
            window.print(); // Triggers the print dialog, allowing the user to Save as PDF
        });

        document.getElementById("shareBtn").addEventListener("click", () => {
             const url = window.location.href;
             const textarea = document.createElement('textarea');
             textarea.value = url;
             textarea.style.position = 'fixed'; 
             document.body.appendChild(textarea);
             textarea.focus();
             textarea.select();
             try {
                 const successful = document.execCommand('copy');
                 if(successful) {
                     const msgBox = document.createElement('div');
                     msgBox.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-3 rounded-xl shadow-2xl transition-opacity duration-300 z-[70]';
                     msgBox.innerText = '✅ Share link copied to clipboard!';
                     document.body.appendChild(msgBox);
                     setTimeout(() => { msgBox.remove(); }, 2000);
                 } else {
                     throw new Error('Copy failed');
                 }
             } catch (err) {
                 const msgBox = document.createElement('div');
                 msgBox.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-500 text-white px-6 py-3 rounded-xl shadow-2xl transition-opacity duration-300 z-[70]';
                 msgBox.innerText = '❌ Failed to copy link. Please copy manually.';
                 document.body.appendChild(msgBox);
                 setTimeout(() => { msgBox.remove(); }, 3000);
             } finally {
                 document.body.removeChild(textarea);
             }
           });
    </script>
</body>
</html>