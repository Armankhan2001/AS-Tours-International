<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTours Blog | Visa & Travel Updates</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        :root {
            --navy: #07203a;
            --gold: #d4af37;
        }
        body {
            font-family: 'Inter', sans-serif; /* Changed to Inter */
            background: linear-gradient(to bottom, #f9fafb, #ffffff); /* Subtle gradient for luxury theme */
        }
        .font-playfair { font-family: 'Playfair Display', serif; }
        .section-title {
            color: var(--navy); /* Primary title color */
            font-weight: 800;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.2rem;
            font-family: 'Playfair Display', serif;
        }
        .card {
            border-radius: 14px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease-in-out;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .flag {
            width: 28px;
            height: 20px;
            object-fit: cover;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid #eee;
        }
        .filter-bar {
            margin-bottom: 30px;
        }
        .modal-content {
            border-radius: 16px;
            box-shadow: 0 6px 28px rgba(0,0,0,0.25);
        }
        .modal-title {
            font-weight: 700;
            color: var(--navy); /* Updated modal title color */
            font-family: 'Playfair Display', serif;
        }
        .modal-footer .btn-primary {
            background-color: var(--navy);
            border-color: var(--navy);
        }
        .modal-footer .btn-primary:hover {
            background-color: #0d3257;
            border-color: #0d3257;
        }
        .card-text {
            flex-grow: 1;
        }
        
        /* --- LUXURY NAVBAR STYLES (Copied for Tailwind usage) --- */
        .logo-badge {
            height: 60px; 
            width: 60px;
            background-color: #ffd700;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border-bottom-right-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        .logo-badge img {
            width: 85%;
            height: auto;
        }
        @media (min-width: 1024px) {
            .logo-badge {
                height: 160px;
                width: 160px;
                box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            }
        }
        .btn-gold {
            background: linear-gradient(90deg, var(--gold), #f3d27a);
            color: var(--navy);
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        /* --- Custom Footer --- */
        footer.luxury-footer {
            background: var(--navy);
            color: white;
            padding: 28px;
            text-align: center;
            font-size: 14px;
            margin-top: 50px;
            border-top: 4px solid var(--gold);
        }
        footer.luxury-footer a {
            color: var(--gold);
        }
    </style>
</head>
<body class="bg-[#f9fafb]">

    <header class="relative top-0 z-50 bg-white/95 backdrop-blur-md shadow-lg">
        <div class="max-w-7xl mx-auto px-4 lg:px-8">
            <div class="flex items-center justify-between h-24">

                <div class="absolute top-0 left-4 z-50">
                    <a href="../index.html" class="logo-badge">
                        <img src="../image/astourlogo.png" alt="AS Tours Logo">
                    </a>
                </div>

                <div class="w-16 lg:w-36 flex-shrink-0"></div>

                <nav class="hidden lg:flex items-center gap-8 text-[--navy] font-medium text-sm">
                    <a href="../index.html" class="hover:text-[--gold] transition-colors">Home</a>
                    <a href="../visa/globalvisa.html" class="hover:text-[--gold] transition-colors">Global Visa</a>
                    <a href="../packages/packages.html" class="hover:text-[--gold] transition-colors">Packages</a>
                    <!-- <a href="../visa/visaservices.html" class="hover:text-[--gold] transition-colors">Visa Services</a> -->
                    <a href="#" class="text-[--gold] font-bold border-b-2 border-[--gold]">News</a>
                    <a href="../templates/Travel/b2b/Visa/b2b.html" class="ml-4 px-6 py-2.5 rounded-full btn-gold shadow-md">Partner with Us</a>
                </nav>

                <div class="lg:hidden ml-auto">
                    <button id="mobileBtn" class="p-2 text-[--navy] hover:bg-gray-100 rounded-md transition-colors">
                        <i class="fas fa-bars fa-lg"></i>
                    </button>
                </div>

            </div>
        </div>

        <div id="mobileMenu" class="hidden lg:hidden bg-white border-t border-gray-200 absolute w-full shadow-lg z-40">
            <div class="flex flex-col px-6 py-6 space-y-4 text-[--navy] font-medium">
                <div class="h-8"></div> <a href="../index.html" class="hover:text-[--gold]">Home</a>
                <a href="../visa/globalvisa.html" class="hover:text-[--gold]">Global Visa</a>
                <a href="../packages/packages.html" class="hover:text-[--gold]">Packages</a>
                <!-- <a href="../visa/visaservices.html" class="hover:text-[--gold]">Visa Services</a> -->
                <a href="#" class="text-[--gold] font-bold">News</a>
                <a href="../templates/Travel/b2b/Visa/b2b.html" class="mt-2 px-4 py-3 rounded-lg btn-gold text-center">Partner with Us</a>
            </div>
        </div>
    </header>
    <section class="py-5">
        <div class="container">
            <h2 class="section-title">üì∞ Visa & Travel Updates</h2>

            <div class="filter-bar row justify-content-center mb-4">
                <div class="col-md-4 mb-2">
                    <input type="text" id="searchBox" class="form-control" placeholder="üîç Search updates...">
                </div>
                <div class="col-md-3 mb-2">
                    <select id="countryFilter" class="form-select">
                        <option value="">üåç All Countries</option>
                    </select>
                </div>
                <div class="col-md-3 mb-2">
                    <select id="sortFilter" class="form-select">
                        <option value="newest">üÜï Newest First</option>
                        <option value="oldest">üìÖ Oldest First</option>
                    </select>
                </div>
            </div>

            <div class="row" id="blog-container"></div>
        </div>
    </section>

    <div class="modal fade" id="overviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted" id="modalMeta"></p>
                    <p id="modalOverview"></p>
                </div>
                <div class="modal-footer">
                    <a id="modalLink" href="#" target="_blank" class="btn btn-primary">
                        Visit Official Link <i class="fas fa-external-link-alt"></i>
                    </a>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="luxury-footer">
        <p>&copy; <script>document.write(new Date().getFullYear())</script> ASTours International. All Rights Reserved.</p>
        <p class="mt-1"><i class="fas fa-globe text-[--gold]"></i> Travel Updates Powered by Google Sheets</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mobile menu toggle logic
        document.getElementById('mobileBtn').addEventListener('click', () => {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        });

        // --- Original Blog Logic (Kept intact) ---

        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9H4rqyeF9_a0N51tVxqx6rRLKYBpEYbSZHxQoDSHSjSA1UX6Xh51IhwZBCPyapkMxQzHqz1h2n4AA/pub?output=csv";
        let posts = [];

        async function loadBlogPosts() {
            try {
                const response = await fetch(sheetUrl);
                const csvData = await response.text();

                Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        posts = results.data.map(r => ({
                            date: r["Date"],
                            title: r["Title"],
                            desc: r["Description"],
                            link: r["Link"],
                            country: r["Country"],
                            cdn: r["CDN Code"],
                            overview: r["Overview"]
                        }));

                        populateCountryFilter();
                        applyFilters(); 
                    }
                });
            } catch (err) {
                console.error("Error loading posts:", err);
            }
        }

        function populateCountryFilter() {
            const countryFilter = document.getElementById("countryFilter");
            const countries = [...new Set(posts.map(p => p.country).filter(Boolean))].sort();
            countries.forEach(c => {
                const option = document.createElement("option");
                option.value = c;
                option.textContent = c;
                countryFilter.appendChild(option);
            });
        }

        function parseDate(dateStr) {
            if (!dateStr) return new Date(0);
            if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return new Date(dateStr);
            const parts = dateStr.split("-");
            if (parts.length === 3) {
                // Assuming DD-MM-YYYY format based on typical CSV inputs not being standardized
                const [day, mon, year] = parts;
                return new Date(`${mon} ${day}, ${year}`);
            }
            return new Date(0);
        }

        function applyFilters() {
            const search = document.getElementById("searchBox").value.toLowerCase();
            const country = document.getElementById("countryFilter").value;
            const sort = document.getElementById("sortFilter").value;

            let filtered = posts.filter(p =>
                (p.title && p.title.toLowerCase().includes(search)) || (p.desc && p.desc.toLowerCase().includes(search)) &&
                (country === "" || p.country === country)
            );

            filtered.sort((a, b) => {
                const da = parseDate(a.date);
                const db = parseDate(b.date);
                return sort === "oldest" ? da - db : db - da;
            });

            displayPosts(filtered);
        }

        function displayPosts(filteredPosts) {
            const container = document.getElementById("blog-container");
            container.innerHTML = "";

            if (filteredPosts.length === 0) {
                container.innerHTML = "<p class='text-center text-muted'>No results found.</p>";
                return;
            }

            filteredPosts.forEach((p, index) => {
                const shortDesc = p.desc.length > 150 ? p.desc.substring(0, 150) + "..." : p.desc;

                const col = document.createElement("div");
                col.className = "col-md-4 mb-4 d-flex";
                col.innerHTML = `
                    <div class="card p-3 shadow-sm w-100">
                        <div>
                            <div class="d-flex align-items-center mb-2">
                                ${p.cdn ? `<img src="https://flagcdn.com/w40/${p.cdn.trim().toLowerCase()}.png" class="flag me-2">` : ""}
                                <h5 class="fw-bold text-[--navy] mb-0">${p.title}</h5>
                            </div>
                            <p class="small text-muted">${p.date} | ${p.country || "General"}</p>
                            <p class="card-text">${shortDesc}</p>
                        </div>
                        <div class="mt-auto">
                            <button class="btn btn-sm btn-outline-primary" style="color: var(--navy); border-color: var(--navy);" onclick="openModal(${posts.indexOf(p)})">
                                Read More
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        function openModal(index) {
            const post = posts[index];
            document.getElementById("modalTitle").textContent = post.title;
            
            // Build modal meta with flag
            let metaHtml = `${post.date} | ${post.country || "General"}`;
            if (post.cdn) {
                metaHtml += `<img src="https://flagcdn.com/w40/${post.cdn.trim().toLowerCase()}.png" class="flag ms-2" style="display:inline-block; vertical-align: middle;">`;
            }
            document.getElementById("modalMeta").innerHTML = metaHtml;

            document.getElementById("modalOverview").textContent = post.overview || post.desc || "No overview available.";
            document.getElementById("modalLink").href = post.link || "#";
            const modal = new bootstrap.Modal(document.getElementById("overviewModal"));
            modal.show();
        }

        document.getElementById("searchBox").addEventListener("input", applyFilters);
        document.getElementById("countryFilter").addEventListener("change", applyFilters);
        document.getElementById("sortFilter").addEventListener("change", applyFilters);

        loadBlogPosts();
    </script>
</body>
</html>