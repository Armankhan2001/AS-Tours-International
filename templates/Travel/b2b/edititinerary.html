<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AsToursInternational â€” Edit Itinerary</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* Custom styles */
:root {
	--navy: #07203a;
	--gold: #d4af37;
}
body {
	font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
	margin: 0;
	background-color: #f3f4f6;
	padding-top: 80px; /* Space for fixed header */
}
.hotel-block, .day-block { border-radius:0.5rem; background:#f9fafb; padding:0.5rem; }

/* --- NAVBAR STYLES --- */
.btn-gold {
	background: linear-gradient(90deg, var(--gold), #f3d27a);
	color: var(--navy);
	font-weight: 600;
	font-size: 0.875rem;
	transition: all 0.3s ease;
	box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.btn-gold:hover {
	transform: translateY(-1px);
	box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

/* Floating Logo badge style */
.logo-badge {
	height: 64px; 
	width: 64px;
	background-color: #ffd700;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 4px; 
	position: fixed; 
	top: 8px; 
	left: 1rem;
	z-index: 60; 
}
.logo-badge img {
	width: 90%;
	height: auto;
	padding: 4px;
}
.nav-link {
	font-size: 0.875rem; 
	font-weight: 500;
	transition: color 0.3s;
	color: var(--navy);
}
.nav-link:hover {
	color: var(--gold);
}

@media (min-width: 1024px) {
	.logo-badge {
		height: 64px; /* Reduced large screen size to prevent spreading */
		width: 64px;
		left: calc(50% - 35rem); 
		top: 8px;
	}
	body { padding-top: 80px; }
	.nav-link { font-size: 0.95rem; }
}
</style>
</head>
<body class="bg-gray-100 min-h-screen font-sans antialiased">

<div class="logo-badge">
Â  Â  <a href="../../../index.html">
Â  Â  Â  Â  <img src="../../../image/astourlogo.png" alt="AS Tours International">
Â  Â  </a>
</div>

<header class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-md shadow-sm z-50 h-20">
Â  Â  <div class="max-w-7xl mx-auto px-4 lg:px-8">
Â  Â  Â  Â  <div class="flex items-center justify-end h-20"> 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-20 md:w-36 flex-shrink-0 lg:hidden"></div>

Â  Â  Â  Â  Â  Â  <nav class="hidden lg:flex items-center gap-8 ml-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="itinerary.html" class="nav-link">New Itinerary</a> 
Â  Â  Â  Â  Â  Â  Â  Â  <a href="saveditinerary.html" class="nav-link">Saved Itineraries</a> 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="openPreviewPage()" class="ml-4 px-5 py-2 text-sm rounded-full btn-gold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘€ Preview Itinerary
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </nav>

Â  Â  Â  Â  Â  Â  <div class="lg:hidden flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="openPreviewPage()" class="px-3 py-1 text-sm rounded-full btn-gold shadow hover:shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘€ Preview
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="mobileBtn" class="p-2 rounded-md hover:bg-gray-100 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[var(--navy)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="mobileMenu" class="hidden lg:hidden bg-white border-t border-gray-200 w-full absolute top-full left-0">
Â  Â  Â  Â  <div class="px-6 py-4 space-y-3 text-[var(--navy)] font-medium">
Â  Â  Â  Â  Â  Â  <a href="itinerary.html" class="nav-link block">New Itinerary</a> Â  Â  Â  Â  Â  Â  <a href="saveditinerary.html" class="nav-link block">Saved Itineraries</a> Â  Â  Â  Â  Â  Â  <button type="button" onclick="openPreviewPage()" class="w-full text-left nav-link">Preview Itinerary</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</header>
<main class="max-w-7xl mx-auto p-6">
Â  Â  <div class="md:max-w-3xl mx-auto">
Â  Â  Â  Â  <form id="formPanel" class="bg-white rounded-2xl shadow p-5 space-y-4">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-[var(--navy)]">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="formTitle">Edit Itinerary</span> 
Â  Â  Â  Â  Â  Â  Â  Â  <span id="saveStatus" class="text-sm text-gray-500 font-normal ml-2"></span>
Â  Â  Â  Â  Â  Â  </h2>

Â  Â  Â  Â  Â  Â  <hr class="border-gray-200" />
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <input type="hidden" id="itineraryId" value="" /> 

Â  Â  Â  Â  Â  Â  <div class="p-4 bg-yellow-50 rounded">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-bold text-gray-700 mb-2">Company/Logo</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="logoUpload" type="file" accept="image/*" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="logoUrl" type="url" placeholder="or paste Logo URL (https://...)" class="border rounded p-2 w-full text-sm" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium">Company Name</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="companyName" placeholder="AsTours International" class="border rounded p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium">Country of Tour</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="tourCountry" placeholder="Brazil" class="border rounded p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2 grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm">Confirmation No.</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="confirmationNo" class="border rounded p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm">Reference (optional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="reference" class="border rounded p-2 w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium">Passenger Details (one per line)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="passengerDetails" rows="3" class="border rounded p-2 w-full" placeholder="Mr. Ahmed Abdul Saeed - Passport W3691761"></textarea>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <hr class="border-gray-200" />

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-lg font-bold text-[var(--navy)]">Hotels / Stays</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addHotel()" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded-full hover:bg-indigo-700 transition">+ Add Hotel</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="hotelsList" class="mt-2 space-y-3"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <hr class="border-gray-200" />

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-lg font-bold text-[var(--navy)]">Extra Day Entries (Manual Overrides)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addManualDay()" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded-full hover:bg-indigo-700 transition">+ Add Day</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="manualDays" class="mt-2 space-y-2"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <hr class="border-gray-200" />

Â  Â  Â  Â  Â  Â  <div class="space-y-4 pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="saveItinerary()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold text-lg hover:bg-green-700 transition shadow-lg">ğŸ’¾ Update Itinerary</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="openPreviewPage()" class="w-full bg-[var(--navy)] text-white py-3 rounded-xl font-bold text-lg hover:bg-[var(--navy)]/90 transition shadow-lg">ğŸ‘€ Preview Changes</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </form>
Â  Â  </div>
</main>

<script>
let logoData = "";

document.addEventListener('DOMContentLoaded', () => {
Â  Â  // Mobile Menu Toggle
Â  Â  document.getElementById('mobileBtn').addEventListener('click', () => {
Â  Â  Â  Â  document.getElementById('mobileMenu').classList.toggle('hidden');
Â  Â  });
Â  Â  
Â  Â  // Check URL for ID to load data
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const id = urlParams.get('id');
Â  Â  if (id) {
Â  Â  Â  Â  loadItineraryForEdit(id);
Â  Â  } else {
Â  Â  Â  Â  // Redirect to the list page if ID is missing
Â  Â  Â  Â  alert("No itinerary ID provided. Redirecting to saved list.");
Â  Â  Â  Â  window.location.href = 'saveditinerary.html'; 
Â  Â  }
});


// --- Form Helpers ---

// Logo upload
document.getElementById('logoUpload').addEventListener('change', e => {
Â  Â  const f = e.target.files[0]; 
Â  Â  if(!f) return;
Â  Â  const reader = new FileReader();
Â  Â  reader.onload = ev => { logoData = ev.target.result; };
Â  Â  reader.readAsDataURL(f);
});

// Add hotel
function addHotel(pref={}) {
Â  Â  const container = document.createElement('div');
Â  Â  container.className='hotel-block grid grid-cols-1 md:grid-cols-4 gap-2 items-center';
Â  Â  container.innerHTML=`
Â  Â  Â  Â  <input class="p-2 border rounded hotel-city" placeholder="City" value="${pref.city||''}" />
Â  Â  Â  Â  <input class="p-2 border rounded hotel-checkin" type="date" value="${pref.checkin||''}" />
Â  Â  Â  Â  <input class="p-2 border rounded hotel-checkout" type="date" value="${pref.checkout||''}" />
Â  Â  Â  Â  <div class="md:col-span-4 grid grid-cols-3 md:grid-cols-6 gap-2 pt-1 md:pt-0">
Â  Â  Â  Â  Â  Â  <input class="col-span-3 md:col-span-3 p-2 border rounded hotel-name" placeholder="Hotel Name" value="${pref.hotel||''}" />
Â  Â  Â  Â  Â  Â  <input class="col-span-2 md:col-span-2 p-2 border rounded hotel-contact" placeholder="Contact" value="${pref.contact||''}" />
Â  Â  Â  Â  Â  Â  <button type="button" class="col-span-1 md:col-span-1 bg-red-500 text-white rounded px-2 hover:bg-red-600 transition" onclick="this.closest('.hotel-block').remove()">âŒ</button>
Â  Â  Â  Â  </div>
Â  Â  `;
Â  Â  document.getElementById('hotelsList').appendChild(container);
}

// Add manual day
function addManualDay(obj={}) {
Â  Â  const div = document.createElement('div');
Â  Â  div.className='day-block grid grid-cols-1 md:grid-cols-4 gap-2 items-center';
Â  Â  div.innerHTML=`
Â  Â  Â  Â  <input type="date" class="p-2 border rounded day-date" value="${obj.date||''}" />
Â  Â  Â  Â  <input class="p-2 border rounded day-title" placeholder="Title" value="${obj.title||''}" />
Â  Â  Â  Â  <input class="p-2 border rounded day-activities" placeholder="Short activity" value="${obj.activities||''}" />
Â  Â  Â  Â  <div class="text-right">
Â  Â  Â  Â  Â  Â  <button type="button" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition" onclick="this.closest('.day-block').remove()">âŒ Remove</button>
Â  Â  Â  Â  </div>
Â  Â  `;
Â  Â  document.getElementById('manualDays').appendChild(div);
}

// Collect form data
function collectData(){
Â  Â  // ID is the original confirmationNo passed in the URL
Â  Â  const originalId = document.getElementById('itineraryId').value;
Â  Â  if (!originalId) {
Â  Â  Â  Â  alert("Error: Cannot save, missing itinerary ID. Refresh the list page and try again.");
Â  Â  Â  Â  return null;
Â  Â  }

Â  Â  const companyName = document.getElementById('companyName').value || '';
Â  Â  const tourCountry = document.getElementById('tourCountry').value || '';
Â  Â  // Get the potentially updated confirmation number
Â  Â  const confirmationNo = document.getElementById('confirmationNo').value || ''; 
Â  Â  const reference = document.getElementById('reference').value || '';
Â  Â  const passengerDetails = (document.getElementById('passengerDetails').value||'').split(/\r?\n/).filter(s=>s.trim());

Â  Â  const hotels = [];
Â  Â  document.querySelectorAll('.hotel-block').forEach(h=>{
Â  Â  Â  Â  const city = h.querySelector('.hotel-city').value;
Â  Â  Â  Â  const checkin = h.querySelector('.hotel-checkin').value;
Â  Â  Â  Â  const checkout = h.querySelector('.hotel-checkout').value;
Â  Â  Â  Â  const hotel = h.querySelector('.hotel-name').value;
Â  Â  Â  Â  const contact = h.querySelector('.hotel-contact').value;
Â  Â  Â  Â  if(city && checkin && checkout && hotel) hotels.push({city, checkin, checkout, hotel, contact});
Â  Â  });

Â  Â  const manualDays = [];
Â  Â  document.querySelectorAll('.day-block').forEach(d=>{
Â  Â  Â  Â  const date = d.querySelector('.day-date').value;
Â  Â  Â  Â  const title = d.querySelector('.day-title').value;
Â  Â  Â  Â  const activities = d.querySelector('.day-activities').value;
Â  Â  Â  Â  if(date || title || activities) manualDays.push({date,title,activities});
Â  Â  });

Â  Â  const logoUrl = document.getElementById('logoUrl').value || '';
Â  Â  const finalLogoData = logoData || ''; 

Â  Â  // Return the object using the ORIGINAL ID for lookups, but the NEW confirmationNo
Â  Â  return {id: originalId, companyName,tourCountry,confirmationNo,reference,passengerDetails,hotels,manualDays,logoUrl,logoData: finalLogoData};
}

// --- Data Persistence (Mock Backend using localStorage) ---

function saveItinerary() {
Â  Â  const data = collectData();
Â  Â  if (!data) return; 

Â  Â  // Use the ID (original confirmationNo) stored in the hidden field to match the entry
Â  Â  const originalId = data.id; 

Â  Â  let saved = JSON.parse(localStorage.getItem('savedItineraries') || '[]');
Â  Â  
Â  Â  // Find the entry in the array by its original confirmationNo
Â  Â  const index = saved.findIndex(item => item.confirmationNo === originalId);
Â  Â  
Â  Â  if (index !== -1) {
Â  Â  Â  Â  // If found, replace the entry with the updated data
Â  Â  Â  Â  saved[index] = data;
Â  Â  } else {
Â  Â  Â  Â  // If not found, prepend it (as a new item)
Â  Â  Â  Â  saved.unshift(data); 
Â  Â  }

Â  Â  // Save to localStorage
Â  Â  localStorage.setItem('savedItineraries', JSON.stringify(saved));
Â  Â  
Â  Â  document.getElementById('saveStatus').textContent = 'Updated!';
Â  Â  setTimeout(() => { document.getElementById('saveStatus').textContent = ''; }, 3000);

Â  Â  alert('Itinerary updated successfully!');
}

function loadItineraryForEdit(id) {
Â  Â  const saved = JSON.parse(localStorage.getItem('savedItineraries') || '[]');
Â  Â  // Look up by confirmationNo, which is passed as the 'id' URL parameter
Â  Â  const data = saved.find(item => item.confirmationNo === id); 

Â  Â  if (!data) {
Â  Â  Â  Â  alert("Itinerary not found. Redirecting to saved list.");
Â  Â  Â  Â  window.location.href = 'saveditinerary.html'; 
Â  Â  Â  Â  return; 
Â  Â  }

Â  Â  // If found, populate the form fields
Â  Â  document.getElementById('formTitle').textContent = `Editing: ${data.companyName || data.confirmationNo || 'Itinerary'}`;
Â  Â  // CRITICAL: Store the original confirmationNo (ID) in the hidden field for saving/lookups
Â  Â  document.getElementById('itineraryId').value = id; 

Â  Â  // Populate Simple Fields
Â  Â  document.getElementById('companyName').value = data.companyName || '';
Â  Â  document.getElementById('tourCountry').value = data.tourCountry || '';
Â  Â  // This ensures the current confirmation number is editable
Â  Â  document.getElementById('confirmationNo').value = data.confirmationNo || ''; 
Â  Â  document.getElementById('reference').value = data.reference || '';
Â  Â  document.getElementById('logoUrl').value = data.logoUrl || '';
Â  Â  
Â  Â  // Populate Passenger Details
Â  Â  document.getElementById('passengerDetails').value = (data.passengerDetails || []).join('\n');
Â  Â  
Â  Â  // Store logoData if present (for preview)
Â  Â  logoData = data.logoData || ""; 

Â  Â  // Populate Hotels
Â  Â  document.getElementById('hotelsList').innerHTML = '';
Â  Â  (data.hotels || []).forEach(h => addHotel(h));

Â  Â  // Populate Manual Days
Â  Â  document.getElementById('manualDays').innerHTML = '';
Â  Â  (data.manualDays || []).forEach(d => addManualDay(d));
}

// Open preview page with data
function openPreviewPage(){
Â  Â  const data = collectData();
Â  Â  if (!data) return;
Â  Â  sessionStorage.setItem('itineraryDataForPreview', JSON.stringify(data));
Â  Â  window.open(`preview.html`,'_blank');
}
</script>

</body>
</html>